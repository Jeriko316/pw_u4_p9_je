{"ast":null,"code":"import _regenerator from \"C:/Users/Ordenador/Documents/1.DOCUMENTOS ERICK/Octavo Semetre/Programacion Web/Deber Autenticacion/pw_u4_p9_je/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"C:/Users/Ordenador/Documents/1.DOCUMENTOS ERICK/Octavo Semetre/Programacion Web/Deber Autenticacion/pw_u4_p9_je/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport axios from \"axios\";\n\n// Cliente de autenticación centralizado\nvar TOKEN_KEY = \"matricula_token\";\nvar setAuthHeader = function setAuthHeader(token) {\n  if (token) {\n    axios.defaults.headers.common[\"Authorization\"] = \"Bearer \".concat(token);\n  } else {\n    delete axios.defaults.headers.common[\"Authorization\"];\n  }\n};\nvar saveToken = function saveToken(token) {\n  if (token) {\n    localStorage.setItem(TOKEN_KEY, token);\n    setAuthHeader(token);\n    window.dispatchEvent(new CustomEvent(\"auth-changed\", {\n      detail: {\n        authenticated: true\n      }\n    }));\n  }\n};\nvar removeToken = function removeToken() {\n  localStorage.removeItem(TOKEN_KEY);\n  setAuthHeader(null);\n  window.dispatchEvent(new CustomEvent(\"auth-changed\", {\n    detail: {\n      authenticated: false\n    }\n  }));\n};\nvar getToken = function getToken() {\n  return localStorage.getItem(TOKEN_KEY);\n};\nvar isAuthenticated = function isAuthenticated() {\n  return !!getToken();\n};\n\n// Inicializar axios con token guardado\nvar _init = function _init() {\n  var t = getToken();\n  if (t) setAuthHeader(t);\n};\n\n// Autenticarse contra el backend de auth y guardar token\nvar AUTH_BASE = process.env.VUE_APP_AUTH_URL || \"http://localhost:8082\";\nvar authenticate = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(user, password) {\n    var response, tokenResp, _t;\n    return _regenerator().w(function (_context) {\n      while (1) switch (_context.p = _context.n) {\n        case 0:\n          _context.p = 0;\n          _context.n = 1;\n          return axios.get(\"\".concat(AUTH_BASE, \"/token\"), {\n            params: {\n              user: user,\n              password: password\n            }\n          });\n        case 1:\n          response = _context.v;\n          tokenResp = response.data;\n          if (!(tokenResp && tokenResp.accessToken)) {\n            _context.n = 2;\n            break;\n          }\n          saveToken(tokenResp.accessToken);\n          return _context.a(2, tokenResp);\n        case 2:\n          throw new Error(\"Respuesta de auth sin accessToken\");\n        case 3:\n          _context.p = 3;\n          _t = _context.v;\n          console.error(\"AuthClient.authenticate error:\", _t.response || _t);\n          throw _t;\n        case 4:\n          return _context.a(2);\n      }\n    }, _callee, null, [[0, 3]]);\n  }));\n  return function authenticate(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\n// Permite fijar el token manualmente (por ejemplo si ya lo obtuvo otra parte)\nvar setToken = function setToken(token) {\n  saveToken(token);\n};\nvar logout = function logout() {\n  removeToken();\n};\n_init();\nexport { authenticate, setToken, logout, getToken, isAuthenticated };","map":{"version":3,"names":["axios","TOKEN_KEY","setAuthHeader","token","defaults","headers","common","concat","saveToken","localStorage","setItem","window","dispatchEvent","CustomEvent","detail","authenticated","removeToken","removeItem","getToken","getItem","isAuthenticated","_init","t","AUTH_BASE","process","env","VUE_APP_AUTH_URL","authenticate","_ref","_asyncToGenerator","_regenerator","m","_callee","user","password","response","tokenResp","_t","w","_context","p","n","get","params","v","data","accessToken","a","Error","console","error","_x","_x2","apply","arguments","setToken","logout"],"sources":["C:/Users/Ordenador/Documents/1.DOCUMENTOS ERICK/Octavo Semetre/Programacion Web/Deber Autenticacion/pw_u4_p9_je/src/client/AuthClient.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\n// Cliente de autenticación centralizado\r\nconst TOKEN_KEY = \"matricula_token\";\r\n\r\nconst setAuthHeader = (token) => {\r\n  if (token) {\r\n    axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n  } else {\r\n    delete axios.defaults.headers.common[\"Authorization\"];\r\n  }\r\n};\r\n\r\nconst saveToken = (token) => {\r\n  if (token) {\r\n    localStorage.setItem(TOKEN_KEY, token);\r\n    setAuthHeader(token);\r\n    window.dispatchEvent(new CustomEvent(\"auth-changed\", { detail: { authenticated: true } }));\r\n  }\r\n};\r\n\r\nconst removeToken = () => {\r\n  localStorage.removeItem(TOKEN_KEY);\r\n  setAuthHeader(null);\r\n  window.dispatchEvent(new CustomEvent(\"auth-changed\", { detail: { authenticated: false } }));\r\n};\r\n\r\nconst getToken = () => {\r\n  return localStorage.getItem(TOKEN_KEY);\r\n};\r\n\r\nconst isAuthenticated = () => {\r\n  return !!getToken();\r\n};\r\n\r\n// Inicializar axios con token guardado\r\nconst _init = () => {\r\n  const t = getToken();\r\n  if (t) setAuthHeader(t);\r\n};\r\n\r\n// Autenticarse contra el backend de auth y guardar token\r\nconst AUTH_BASE = process.env.VUE_APP_AUTH_URL || \"http://localhost:8082\";\r\n\r\nconst authenticate = async (user, password) => {\r\n  try {\r\n    const response = await axios.get(`${AUTH_BASE}/token`, {\r\n      params: { user, password },\r\n    });\r\n    const tokenResp = response.data;\r\n    if (tokenResp && tokenResp.accessToken) {\r\n      saveToken(tokenResp.accessToken);\r\n      return tokenResp;\r\n    }\r\n    throw new Error(\"Respuesta de auth sin accessToken\");\r\n  } catch (error) {\r\n    console.error(\"AuthClient.authenticate error:\", error.response || error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Permite fijar el token manualmente (por ejemplo si ya lo obtuvo otra parte)\r\nconst setToken = (token) => {\r\n  saveToken(token);\r\n};\r\n\r\nconst logout = () => {\r\n  removeToken();\r\n};\r\n\r\n_init();\r\n\r\nexport { authenticate, setToken, logout, getToken, isAuthenticated };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}