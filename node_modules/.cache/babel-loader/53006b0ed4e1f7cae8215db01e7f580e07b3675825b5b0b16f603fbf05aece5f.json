{"ast":null,"code":"import _regenerator from \"/home/jerikozc/Documentos/PROGRAMACION WEB P9/taller guardianes/front/pw_u4_p9_je/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"/home/jerikozc/Documentos/PROGRAMACION WEB P9/taller guardianes/front/pw_u4_p9_je/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport axios from \"axios\";\n\n// Cliente de autenticaciÃ³n centralizado\nvar TOKEN_KEY = \"matricula_token\";\nvar setAuthHeader = function setAuthHeader(token) {\n  if (token) {\n    axios.defaults.headers.common[\"Authorization\"] = \"Bearer \".concat(token);\n  } else {\n    delete axios.defaults.headers.common[\"Authorization\"];\n  }\n};\nvar saveToken = function saveToken(token) {\n  if (token) {\n    localStorage.setItem(TOKEN_KEY, token);\n    setAuthHeader(token);\n    window.dispatchEvent(new CustomEvent(\"auth-changed\", {\n      detail: {\n        authenticated: true\n      }\n    }));\n  }\n};\nvar removeToken = function removeToken() {\n  localStorage.removeItem(TOKEN_KEY);\n  setAuthHeader(null);\n  window.dispatchEvent(new CustomEvent(\"auth-changed\", {\n    detail: {\n      authenticated: false\n    }\n  }));\n};\nvar getToken = function getToken() {\n  return localStorage.getItem(TOKEN_KEY);\n};\nvar isAuthenticated = function isAuthenticated() {\n  return !!getToken();\n};\n\n// Inicializar axios con token guardado\nvar _init = function _init() {\n  var t = getToken();\n  if (t) setAuthHeader(t);\n};\n\n// Autenticarse contra el backend de auth y guardar token\n// Nota: /token va al proxy que redirige a http://localhost:8082/token\nvar authenticate = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(user, password) {\n    var url, response, tokenResp, _t;\n    return _regenerator().w(function (_context) {\n      while (1) switch (_context.p = _context.n) {\n        case 0:\n          _context.p = 0;\n          url = \"/token\"; // Proxy lo redirige a http://localhost:8082/token\n          console.log(\"ðŸ” Autenticando... URL:\", url);\n          console.log(\"   Credenciales: user=\" + user + \", password=\" + password);\n          _context.n = 1;\n          return axios.get(url, {\n            params: {\n              user: user,\n              password: password\n            }\n          });\n        case 1:\n          response = _context.v;\n          console.log(\"âœ… Respuesta 200 OK:\", response.data);\n          tokenResp = response.data;\n          if (!(tokenResp && tokenResp.accessToken)) {\n            _context.n = 2;\n            break;\n          }\n          saveToken(tokenResp.accessToken);\n          console.log(\"âœ… Token guardado en localStorage\");\n          return _context.a(2, tokenResp);\n        case 2:\n          throw new Error(\"Respuesta de auth sin accessToken\");\n        case 3:\n          _context.p = 3;\n          _t = _context.v;\n          console.error(\"âŒ Error en authenticate:\");\n          if (_t.response) {\n            console.error(\"  Status:\", _t.response.status);\n            console.error(\"  Data:\", _t.response.data);\n          } else {\n            console.error(\"  Error:\", _t.message);\n          }\n          throw _t;\n        case 4:\n          return _context.a(2);\n      }\n    }, _callee, null, [[0, 3]]);\n  }));\n  return function authenticate(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\n// Permite fijar el token manualmente (por ejemplo si ya lo obtuvo otra parte)\nvar setToken = function setToken(token) {\n  saveToken(token);\n};\nvar logout = function logout() {\n  removeToken();\n};\n_init();\nexport { authenticate, setToken, logout, getToken, isAuthenticated };","map":{"version":3,"names":["axios","TOKEN_KEY","setAuthHeader","token","defaults","headers","common","concat","saveToken","localStorage","setItem","window","dispatchEvent","CustomEvent","detail","authenticated","removeToken","removeItem","getToken","getItem","isAuthenticated","_init","t","authenticate","_ref","_asyncToGenerator","_regenerator","m","_callee","user","password","url","response","tokenResp","_t","w","_context","p","n","console","log","get","params","v","data","accessToken","a","Error","error","status","message","_x","_x2","apply","arguments","setToken","logout"],"sources":["/home/jerikozc/Documentos/PROGRAMACION WEB P9/taller guardianes/front/pw_u4_p9_je/src/client/AuthClient.js"],"sourcesContent":["import axios from \"axios\";\n\n// Cliente de autenticaciÃ³n centralizado\nconst TOKEN_KEY = \"matricula_token\";\n\nconst setAuthHeader = (token) => {\n  if (token) {\n    axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n  } else {\n    delete axios.defaults.headers.common[\"Authorization\"];\n  }\n};\n\nconst saveToken = (token) => {\n  if (token) {\n    localStorage.setItem(TOKEN_KEY, token);\n    setAuthHeader(token);\n    window.dispatchEvent(new CustomEvent(\"auth-changed\", { detail: { authenticated: true } }));\n  }\n};\n\nconst removeToken = () => {\n  localStorage.removeItem(TOKEN_KEY);\n  setAuthHeader(null);\n  window.dispatchEvent(new CustomEvent(\"auth-changed\", { detail: { authenticated: false } }));\n};\n\nconst getToken = () => {\n  return localStorage.getItem(TOKEN_KEY);\n};\n\nconst isAuthenticated = () => {\n  return !!getToken();\n};\n\n// Inicializar axios con token guardado\nconst _init = () => {\n  const t = getToken();\n  if (t) setAuthHeader(t);\n};\n\n// Autenticarse contra el backend de auth y guardar token\n// Nota: /token va al proxy que redirige a http://localhost:8082/token\nconst authenticate = async (user, password) => {\n  try {\n    const url = \"/token\";  // Proxy lo redirige a http://localhost:8082/token\n    console.log(\"ðŸ” Autenticando... URL:\", url);\n    console.log(\"   Credenciales: user=\" + user + \", password=\" + password);\n    \n    const response = await axios.get(url, {\n      params: { user, password },\n    });\n    \n    console.log(\"âœ… Respuesta 200 OK:\", response.data);\n    \n    const tokenResp = response.data;\n    if (tokenResp && tokenResp.accessToken) {\n      saveToken(tokenResp.accessToken);\n      console.log(\"âœ… Token guardado en localStorage\");\n      return tokenResp;\n    }\n    throw new Error(\"Respuesta de auth sin accessToken\");\n  } catch (error) {\n    console.error(\"âŒ Error en authenticate:\");\n    if (error.response) {\n      console.error(\"  Status:\", error.response.status);\n      console.error(\"  Data:\", error.response.data);\n    } else {\n      console.error(\"  Error:\", error.message);\n    }\n    throw error;\n  }\n};\n\n// Permite fijar el token manualmente (por ejemplo si ya lo obtuvo otra parte)\nconst setToken = (token) => {\n  saveToken(token);\n};\n\nconst logout = () => {\n  removeToken();\n};\n\n_init();\n\nexport { authenticate, setToken, logout, getToken, isAuthenticated };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}